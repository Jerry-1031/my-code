#import<iostream>
#define R i]
#define Q x]
#define P(a)};I a(I&x,I y=0,I X=0){
#define B;for(I i=h[Q,t;i;i=l[R)if(d[t=e[R]>=O
typedef int I,U[1<<25],V[1<<18];long Z;I x,O,u,P,m,M,i,j,w;U c[2],s,v;V e,l,h,a,r,t,f,S,z,Y,d,p[60]{P(A)e[++m]=y,l[m]=h[Q,Y[h[Q=m]=w;P(G)I i=w>v[Q,S=s[Q;y?x&&G(c[v[Q<=-w&&(Z+=s[x[*c]]*u+u)][Q,1):++s[x?s[G(c[R[Q),w]<S*.8?:s[s[c[!R[w]=Q-=s[w]-s[c[R[Q=c[!R[w]]-1,x=w]=S:v[x=++M]=w,w=Q;P(D)I J=z[Q=1;d[Q=O+1,p[O][Q=y,w=y-a[Q,u||G(j)B&&t^X)D(t,y+Y[R,x),z[Q+=w=z[t],J>w?:J=w;J>u/2+1|z[Q<u/2?:P=x;P(W)u=X,D(x),f[x=P]=y,S[Q=X,t[Q=j,D(x,u=j=0),r[Q=j,d[Q=O++B)j=0,D(t,Y[R),W(t,x,z[t]),--O;P(T)w=p[j-!y][R-a[R,G(x,u=y-1),G(x);}main(){for(scanf("%d%d");std::cin>>u>>w>>a[++R;j=t[x=P],O=d[Q,W(x,f[Q,S[Q),printf("%ld ",Z)){for(x=d[R=d[u^=Z%(I)1e9]+1;x--;p[Q[R=p[Q[u]+w);for(A(i,u),A(f[O=R=u,i);x=O;(O=f[Q)&&S[T(t[Q),Q>S[O]*.9?P=O:0)++S[Q,j=d[Q,T(r[Q,2);}}